# SIEM Plan



## System security

### Wazuh

#### Configuration

#### Audit

#### CIS

#### FIM

#### OpenSCAP

#### Policy Monitoring

### Windows Events

#### Active Directory

#### Events ID repository

| Category           | Subcategory                                                  | Type             | Event Log | Event ID | Describe                                                     | Event ID for Windows 2003                                 |
| ------------------ | ------------------------------------------------------------ | ---------------- | --------- | -------- | ------------------------------------------------------------ | --------------------------------------------------------- |
| Account Logon      | Credential Validation                                        | Success, Failure | Security  | 4776     | The domain controller attempted to validate the credentials for an account | 680, 681                                                  |
| Account Management | Computer Account Management                                  | Success          | Security  | 4741     | A computer account was created                               | 645                                                       |
| Account Management | Computer Account Management                                  | Success          | Security  | 4742     | A computer account was changed                               | 646                                                       |
| Account Management | Computer Account Management                                  | Success          | Security  | 4743     | A computer account was deleted                               | 647                                                       |
| Account Management | Distribution Group Management                                | Success          | Security  | 4744     | A security-disabled local group was created                  | 648                                                       |
| Account Management | Distribution Group Management                                | Success          | Security  | 4746     | A member was added to a security-disabled local group        | 650                                                       |
| Account Management | Distribution Group Management                                | Success          | Security  | 4747     | A member was removed from a security-disabled local group    | 651                                                       |
| Account Management | Distribution Group Management                                | Success          | Security  | 4748     | A security-disabled local group was deleted                  | 652                                                       |
| Account Management | Distribution Group Management                                | Success          | Security  | 4749     | A security-disabled global group was created                 | 653                                                       |
| Account Management | Distribution Group Management                                | Success          | Security  | 4751     | A member was added to a security-disabled global group       | 655                                                       |
| Account Management | Distribution Group Management                                | Success          | Security  | 4752     | A member was removed from a security-disabled global group   | 656                                                       |
| Account Management | Distribution Group Management                                | Success          | Security  | 4753     | A security-disabled global group was deleted                 | 657                                                       |
| Account Management | Distribution Group Management                                | Success          | Security  | 4759     | A security-disabled universal group was created              | 663                                                       |
| Account Management | Distribution Group Management                                | Success          | Security  | 4761     | A member was added to a security-disabled universal group    | 655                                                       |
| Account Management | Distribution Group Management                                | Success          | Security  | 4762     | A member was removed from a security-disabled universal group | 666                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4727     | A security-enabled global group was created                  | 631                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4728     | A member was added to a security-enabled global group        | 632                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4729     | A member was removed from a security-enabled global group    | 633                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4730     | A security-enabled global group was deleted                  | 634                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4731     | A security-enabled local group was created                   | 635                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4732     | A member was added to a security-enabled local group         | 636                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4733     | A member was removed from a security-enabled local group     | 637                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4734     | A security-enabled local group was deleted                   | 638                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4754     | A security-enabled universal group was created               | 658                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4755     | A security-enabled universal group was changed               | 659                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4756     | A member was added to a security-enabled universal group     | 660                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4757     | A member was removed from a security-enabled universal group | 661                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4758     | A security-enabled universal group was deleted               | 662                                                       |
| Account Management | Security Group Management                                    | Success          | Security  | 4764     | A groups type was changed                                    | 668                                                       |
| Account Management | User Account Management                                      | Success          | Security  | 4720     | A user account was created                                   | 624                                                       |
| Account Management | User Account Management                                      | Success          | Security  | 4722     | A user account was enabled                                   | 626                                                       |
| Account Management | User Account Management                                      | Success          | Security  | 4723     | An attempt was made to change an account's password          | 627                                                       |
| Account Management | User Account Management                                      | Success          | Security  | 4724     | An attempt was made to reset an accounts password            | 628                                                       |
| Account Management | User Account Management                                      | Success          | Security  | 4725     | A user account was disabled                                  | 629                                                       |
| Account Management | User Account Management                                      | Success          | Security  | 4726     | A user account was deleted                                   | 630                                                       |
| Account Management | User Account Management                                      | Success          | Security  | 4738     | A user account was changed                                   | 642                                                       |
| Account Management | User Account Management                                      | Success          | Security  | 4740     | A user account was locked out                                | 644                                                       |
| Account Management | User Account Management                                      | Success          | Security  | 4765     | SID History was added to an account                          |                                                           |
| Account Management | User Account Management                                      | Failure          | Security  | 4766     | An attempt to add SID History to an account failed           |                                                           |
| Account Management | User Account Management                                      | Success          | Security  | 4781     | The name of an account was changed                           | 685                                                       |
| Directory Service  | Directory Service Changes                                    | Success          | Security  | 5136     | A directory service object was modified                      | 566                                                       |
| Directory Service  | Directory Service Changes                                    | Success          | Security  | 5137     | A directory service object was created                       | 566                                                       |
| Directory Service  | Directory Service Changes                                    | Success          | Security  | 5138     | A directory service object was undeleted                     |                                                           |
| Directory Service  | Directory Service Changes                                    | Success          | Security  | 5139     | A directory service object was moved                         |                                                           |
| Directory Service  | Directory Service Changes                                    | Failure          | Security  | 5141     | A directory service object was deleted                       |                                                           |
| Logon/Logoff       | Logon                                                        | Success          | Security  | 4624     | An account was successfully logged on                        | 528 , 540                                                 |
| Logon/Logoff       | Logon                                                        | Failure          | Security  | 4625     | An account failed to log on                                  | 529 , 530 , 531 , 532 , 533 , 534 , 535 , 536 , 537 , 539 |
| Object Access      | Detailed File Share                                          | Success, Failure | Security  | 5145     | A network share object was checked to see whether client can be granted desired access |                                                           |
| Object Access      | File Share                                                   | Success          | Security  | 5140     | A network share object was accessed                          |                                                           |
| Object Access      | File Share                                                   | Success          | Security  | 5142     | A network share object was added.                            |                                                           |
| Object Access      | File System, Registry, Kernel Object, SAM, Other Object Access Events | Success          | Security  | 4663     | An attempt was made to access an object                      | 567                                                       |
| Object Access      | File System, Registry, Policy Change, Authorization Policy Change | Success          | Security  | 4670     | Permissions on an object were changed                        |                                                           |
| Object Access      | File System, Registry, SAM, Handle Manipulation, Other Object Access Events | Success, Failure | Security  | 4656     | A handle to an object was requested                          | 560                                                       |
| Object Access      |                                                              | Success          | Security  | 561      | Handle Allocated                                             |                                                           |
| System             | Security State Change                                        | Success          | Security  | 4608     | Windows is starting up                                       | 512                                                       |
| System             | Security State Change                                        | Success          | Security  | 4616     | The system time was changed.                                 | 520                                                       |
| System             | Security System Extension                                    | Success          | Security  | 4610     | An authentication package has been loaded by the Local Security Authority | 514                                                       |
| System             | System Integrity                                             | Success          | Security  | 4612     | Internal resources allocated for the queuing of audit messages have been exhausted, leading to the loss of some audits | 516                                                       |
| System             | System Integrity                                             | Success          | Security  | 4615     | Invalid use of LPC port                                      | 519                                                       |

### Linux

#### Syslog

### IOC



## Network Analytics Plan

### Network probe

#### Configuration

#### Bad reputation

#### By source

#### By destination

#### Topology



## Security rules

### Windows security rules

````md
| Nr. | Architecture/Application | Rule Name                                                    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Index name   | Requirements                                     | Source                       | Time definition            | Threashold |
|-----|--------------------------|--------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|--------------------------------------------------|------------------------------|----------------------------|------------|
| 1   | Windows                  | Windows - Admin night logon                                  | Alert on Windows login events when detected outside business hours                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 2   | Windows                  | Windows - Admin task as user                                 | Alert when admin task is initiated by regular user.  Windows event id 4732 is verified towards static admin list. If the user does not belong to admin list AND the event is seen than we generate alert. Static Admin list is a logstash  disctionary file that needs to be created manually. During Logstash lookup a field user.role:admin is added to an event.4732: A member was added to a security-enabled local group                                                                                                                                                                                                                                       | winlogbeat-* | winlogbeatLogstash admin dicstionary lookup file | Widnows Security Eventlog    | Every 1min                 | 1          |
| 3   | Windows                  | Windows - diff IPs logon                                     | Alert when Windows logon process is detected and two or more different IP addressed are seen in source field.  Timeframe is last 15min.Detection is based onevents 4624 or 1200.4624: An account was successfully logged on1200: Application token success                                                                                                                                                                                                                                                                                                                                                                                                          | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min, for last 15min | 1          |
| 4   | Windows                  | Windows - Event service error                                | Alert when Windows event 1108 is matched1108: The event logging service encountered an error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 5   | Windows                  | Windows - file insufficient privileges                       | Alert when Windows event 5145 is matched5145: A network share object was checked to see whether client can be granted desired accessEvery time a network share object (file or folder) is accessed, event 5145 is logged. If the access is denied at the file share level, it is audited as a failure event. Otherwise, it considered a success. This event is not generated for NTFS access.                                                                                                                                                                                                                                                                       | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min, for last 15min | 50         |
| 6   | Windows                  | Windows - Kerberos pre-authentication failed                 | Alert when Windows event 4625 or 4771 is matched 4625: An account failed to log on 4771: Kerberos pre-authentication failed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 7   | Windows                  | Windows - Logs deleted                                       | Alert when Windows event 1102 OR 104 is matched1102: The audit log was cleared104: Event log cleared                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 8   | Windows                  | Windows - Member added to a security-enabled global group    | Alert when Windows event 4728 is matched4728: A member was added to a security-enabled global group                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 9   | Windows                  | Windows - Member added to a security-enabled local group     | Alert when Windows event 4732 is matched4732: A member was added to a security-enabled local group                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 10  | Windows                  | Windows - Member added to a security-enabled universal group | Alert when Windows event 4756 is matched4756: A member was added to a security-enabled universal group                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 11  | Windows                  | Windows - New device                                         | Alert when Windows event 6414 is matched6416: A new external device was recognized by the system                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 12  | Windows                  | Windows - Package installation                               | Alert when Windows event 4697 is matched 4697: A service was installed in the system                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 13  | Windows                  | Windows - Password policy change                             | Alert when Windows event 4739 is matched4739: Domain Policy was changed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 14  | Windows                  | Windows - Security log full                                  | Alert when Windows event 1104 is matched1104: The security Log is now full                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 15  | Windows                  | Windows - Start up                                           | Alert when Windows event 4608 is matched 4608: Windows is starting up                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 16  | Windows                  | Windows - Account lock                                       | Alert when Windows event 4740 is matched4740: A User account was Locked out                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 17  | Windows                  | Windows - Security local group was changed                   | Alert when Windows event 4735 is matched4735: A security-enabled local group was changed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 18  | Windows                  | Windows - Reset password attempt                             | Alert when Windows event 4724 is matched4724: An attempt was made to reset an accounts password                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 19  | Windows                  | Windows - Code integrity changed                             | Alert when Windows event 5038 is matched5038: Detected an invalid image hash of a fileInformation:    Code Integrity is a feature that improves the security of the operating system by validating the integrity of a driver or system file each time it is loaded into memory.    Code Integrity detects whether an unsigned driver or system file is being loaded into the kernel, or whether a system file has been modified by malicious software that is being run by a user account with administrative permissions.    On x64-based versions of the operating system, kernel-mode drivers must be digitally signed.The event logs the following information: | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 20  | Windows                  | Windows - Application error                                  | Alert when Windows event 1000 is matched1000: Application error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | winlogbeat-* | winlogbeat                                       | Widnows Application Eventlog | Every 1min                 | 1          |
| 21  | Windows                  | Windows - Application hang                                   | Alert when Windows event 1001 OR 1002 is matched1001: Application fault bucket1002: Application hang                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | winlogbeat-* | winlogbeat                                       | Widnows Application Eventlog | Every 1min                 | 1          |
| 22  | Windows                  | Windows - Audit policy changed                               | Alert when Windows event 4719 is matched4719: System audit policy was changed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 23  | Windows                  | Windows - Eventlog service stopped                           | Alert when Windows event 6005 is matched6005: Eventlog service stopped                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 24  | Windows                  | Windows - New service installed                              | Alert when Windows event 7045 OR 4697 is matched7045,4697: A service was installed in the system                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 25  | Windows                  | Windows - Driver loaded                                      | Alert when Windows event 6 is matched6: Driver loadedThe driver loaded events provides information about a driver being loaded on the system. The configured hashes are provided as well as signature information. The signature is created asynchronously for performance reasons and indicates if the file was removed after loading.                                                                                                                                                                                                                                                                                                                             | winlogbeat-* | winlogbeat                                       | Widnows System Eventlog      | Every 1min                 | 1          |
| 26  | Windows                  | Windows - Firewall rule modified                             | Alert when Windows event 2005 is matched2005: A Rule has been modified in the Windows firewall Exception List                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 27  | Windows                  | Windows - Firewall rule add                                  | Alert when Windows event 2004 is matched2004: A firewall rule has been added                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 28  |                          | Windows - Firewall rule deleted                              | Alert when Windows event 2006 or 2033 or 2009 is matched2006,2033,2009: Firewall rule deleted                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
````



