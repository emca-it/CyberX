# SIEM Plan



## System security

### Wazuh

#### Configuration

#### Audit

#### CIS

#### FIM

#### OpenSCAP

#### Policy Monitoring

### Windows Events

#### Active Directory

#### Events ID repository

```
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Category       | Subcategory    | Type           | Event Log      | Event ID       | Describe       | Event ID for   |
|                |                |                |                |                |                | Windows 2003   |
+================+================+================+================+================+================+================+
| Account Logon  | Credential     | Success,       | Security       | 4776           | The domain     | 680, 681       |
|                | Validation     | Failure        |                |                | controller     |                |
|                |                |                |                |                | attempted to   |                |
|                |                |                |                |                | validate the   |                |
|                |                |                |                |                | credentials    |                |
|                |                |                |                |                | for an account |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Computer       | Success        | Security       | 4741           | A computer     | 645            |
| Management     | Account        |                |                |                | account was    |                |
|                | Management     |                |                |                | created        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Computer       | Success        | Security       | 4742           | A computer     | 646            |
| Management     | Account        |                |                |                | account was    |                |
|                | Management     |                |                |                | changed        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Computer       | Success        | Security       | 4743           | A computer     | 647            |
| Management     | Account        |                |                |                | account was    |                |
|                | Management     |                |                |                | deleted        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Distribution   | Success        | Security       | 4744           | A security-    | 648            |
| Management     | Group          |                |                |                | disabled local |                |
|                | Management     |                |                |                | group was      |                |
|                |                |                |                |                | created        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Distribution   | Success        | Security       | 4746           | A member was   | 650            |
| Management     | Group          |                |                |                | added to a     |                |
|                | Management     |                |                |                | security-      |                |
|                |                |                |                |                | disabled local |                |
|                |                |                |                |                | group          |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Distribution   | Success        | Security       | 4747           | A member was   | 651            |
| Management     | Group          |                |                |                | removed from a |                |
|                | Management     |                |                |                | security-      |                |
|                |                |                |                |                | disabled local |                |
|                |                |                |                |                | group          |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Distribution   | Success        | Security       | 4748           | A security-    | 652            |
| Management     | Group          |                |                |                | disabled local |                |
|                | Management     |                |                |                | group was      |                |
|                |                |                |                |                | deleted        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Distribution   | Success        | Security       | 4749           | A security-    | 653            |
| Management     | Group          |                |                |                | disabled       |                |
|                | Management     |                |                |                | global group   |                |
|                |                |                |                |                | was created    |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Distribution   | Success        | Security       | 4751           | A member was   | 655            |
| Management     | Group          |                |                |                | added to a     |                |
|                | Management     |                |                |                | security-      |                |
|                |                |                |                |                | disabled       |                |
|                |                |                |                |                | global group   |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Distribution   | Success        | Security       | 4752           | A member was   | 656            |
| Management     | Group          |                |                |                | removed from a |                |
|                | Management     |                |                |                | security-      |                |
|                |                |                |                |                | disabled       |                |
|                |                |                |                |                | global group   |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Distribution   | Success        | Security       | 4753           | A security-    | 657            |
| Management     | Group          |                |                |                | disabled       |                |
|                | Management     |                |                |                | global group   |                |
|                |                |                |                |                | was deleted    |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Distribution   | Success        | Security       | 4759           | A security-    | 663            |
| Management     | Group          |                |                |                | disabled       |                |
|                | Management     |                |                |                | universal      |                |
|                |                |                |                |                | group was      |                |
|                |                |                |                |                | created        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Distribution   | Success        | Security       | 4761           | A member was   | 655            |
| Management     | Group          |                |                |                | added to a     |                |
|                | Management     |                |                |                | security-      |                |
|                |                |                |                |                | disabled       |                |
|                |                |                |                |                | universal      |                |
|                |                |                |                |                | group          |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Distribution   | Success        | Security       | 4762           | A member was   | 666            |
| Management     | Group          |                |                |                | removed from a |                |
|                | Management     |                |                |                | security-      |                |
|                |                |                |                |                | disabled       |                |
|                |                |                |                |                | universal      |                |
|                |                |                |                |                | group          |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4727           | A security-    | 631            |
| Management     | Management     |                |                |                | enabled global |                |
|                |                |                |                |                | group was      |                |
|                |                |                |                |                | created        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4728           | A member was   | 632            |
| Management     | Management     |                |                |                | added to a     |                |
|                |                |                |                |                | security-      |                |
|                |                |                |                |                | enabled global |                |
|                |                |                |                |                | group          |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4729           | A member was   | 633            |
| Management     | Management     |                |                |                | removed from a |                |
|                |                |                |                |                | security-      |                |
|                |                |                |                |                | enabled global |                |
|                |                |                |                |                | group          |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4730           | A security-    | 634            |
| Management     | Management     |                |                |                | enabled global |                |
|                |                |                |                |                | group was      |                |
|                |                |                |                |                | deleted        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4731           | A security-    | 635            |
| Management     | Management     |                |                |                | enabled local  |                |
|                |                |                |                |                | group was      |                |
|                |                |                |                |                | created        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4732           | A member was   | 636            |
| Management     | Management     |                |                |                | added to a     |                |
|                |                |                |                |                | security-      |                |
|                |                |                |                |                | enabled local  |                |
|                |                |                |                |                | group          |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4733           | A member was   | 637            |
| Management     | Management     |                |                |                | removed from a |                |
|                |                |                |                |                | security-      |                |
|                |                |                |                |                | enabled local  |                |
|                |                |                |                |                | group          |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4734           | A security-    | 638            |
| Management     | Management     |                |                |                | enabled local  |                |
|                |                |                |                |                | group was      |                |
|                |                |                |                |                | deleted        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4754           | A security-    | 658            |
| Management     | Management     |                |                |                | enabled        |                |
|                |                |                |                |                | universal      |                |
|                |                |                |                |                | group was      |                |
|                |                |                |                |                | created        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4755           | A security-    | 659            |
| Management     | Management     |                |                |                | enabled        |                |
|                |                |                |                |                | universal      |                |
|                |                |                |                |                | group was      |                |
|                |                |                |                |                | changed        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4756           | A member was   | 660            |
| Management     | Management     |                |                |                | added to a     |                |
|                |                |                |                |                | security-      |                |
|                |                |                |                |                | enabled        |                |
|                |                |                |                |                | universal      |                |
|                |                |                |                |                | group          |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4757           | A member was   | 661            |
| Management     | Management     |                |                |                | removed from a |                |
|                |                |                |                |                | security-      |                |
|                |                |                |                |                | enabled        |                |
|                |                |                |                |                | universal      |                |
|                |                |                |                |                | group          |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4758           | A security-    | 662            |
| Management     | Management     |                |                |                | enabled        |                |
|                |                |                |                |                | universal      |                |
|                |                |                |                |                | group was      |                |
|                |                |                |                |                | deleted        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | Security Group | Success        | Security       | 4764           | A groups type  | 668            |
| Management     | Management     |                |                |                | was changed    |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | User Account   | Success        | Security       | 4720           | A user account | 624            |
| Management     | Management     |                |                |                | was created    |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | User Account   | Success        | Security       | 4722           | A user account | 626            |
| Management     | Management     |                |                |                | was enabled    |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | User Account   | Success        | Security       | 4723           | An attempt was | 627            |
| Management     | Management     |                |                |                | made to change |                |
|                |                |                |                |                | an account's   |                |
|                |                |                |                |                | password       |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | User Account   | Success        | Security       | 4724           | An attempt was | 628            |
| Management     | Management     |                |                |                | made to reset  |                |
|                |                |                |                |                | an accounts    |                |
|                |                |                |                |                | password       |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | User Account   | Success        | Security       | 4725           | A user account | 629            |
| Management     | Management     |                |                |                | was disabled   |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | User Account   | Success        | Security       | 4726           | A user account | 630            |
| Management     | Management     |                |                |                | was deleted    |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | User Account   | Success        | Security       | 4738           | A user account | 642            |
| Management     | Management     |                |                |                | was changed    |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | User Account   | Success        | Security       | 4740           | A user account | 644            |
| Management     | Management     |                |                |                | was locked out |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | User Account   | Success        | Security       | 4765           | SID History    |                |
| Management     | Management     |                |                |                | was added to   |                |
|                |                |                |                |                | an account     |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | User Account   | Failure        | Security       | 4766           | An attempt to  |                |
| Management     | Management     |                |                |                | add SID        |                |
|                |                |                |                |                | History to an  |                |
|                |                |                |                |                | account failed |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Account        | User Account   | Success        | Security       | 4781           | The name of an | 685            |
| Management     | Management     |                |                |                | account was    |                |
|                |                |                |                |                | changed        |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Directory      | Directory      | Success        | Security       | 5136           | A directory    | 566            |
| Service        | Service        |                |                |                | service object |                |
|                | Changes        |                |                |                | was modified   |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Directory      | Directory      | Success        | Security       | 5137           | A directory    | 566            |
| Service        | Service        |                |                |                | service object |                |
|                | Changes        |                |                |                | was created    |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Directory      | Directory      | Success        | Security       | 5138           | A directory    |                |
| Service        | Service        |                |                |                | service object |                |
|                | Changes        |                |                |                | was undeleted  |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Directory      | Directory      | Success        | Security       | 5139           | A directory    |                |
| Service        | Service        |                |                |                | service object |                |
|                | Changes        |                |                |                | was moved      |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Directory      | Directory      | Failure        | Security       | 5141           | A directory    |                |
| Service        | Service        |                |                |                | service object |                |
|                | Changes        |                |                |                | was deleted    |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Logon/Logoff   | Logon          | Success        | Security       | 4624           | An account was | 528 , 540      |
|                |                |                |                |                | successfully   |                |
|                |                |                |                |                | logged on      |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Logon/Logoff   | Logon          | Failure        | Security       | 4625           | An account     | 529 , 530 ,    |
|                |                |                |                |                | failed to log  | 531 , 532 ,    |
|                |                |                |                |                | on             | 533 , 534 ,    |
|                |                |                |                |                |                | 535 , 536 ,    |
|                |                |                |                |                |                | 537 , 539      |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Object Access  | Detailed File  | Success,       | Security       | 5145           | A network      |                |
|                | Share          | Failure        |                |                | share object   |                |
|                |                |                |                |                | was checked to |                |
|                |                |                |                |                | see whether    |                |
|                |                |                |                |                | client can be  |                |
|                |                |                |                |                | granted        |                |
|                |                |                |                |                | desired access |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Object Access  | File Share     | Success        | Security       | 5140           | A network      |                |
|                |                |                |                |                | share object   |                |
|                |                |                |                |                | was accessed   |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Object Access  | File Share     | Success        | Security       | 5142           | A network      |                |
|                |                |                |                |                | share object   |                |
|                |                |                |                |                | was added.     |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Object Access  | File System,   | Success        | Security       | 4663           | An attempt was | 567            |
|                | Registry,      |                |                |                | made to access |                |
|                | Kernel Object, |                |                |                | an object      |                |
|                | SAM, Other     |                |                |                |                |                |
|                | Object Access  |                |                |                |                |                |
|                | Events         |                |                |                |                |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Object Access  | File System,   | Success        | Security       | 4670           | Permissions on |                |
|                | Registry,      |                |                |                | an object were |                |
|                | Policy Change, |                |                |                | changed        |                |
|                | Authorization  |                |                |                |                |                |
|                | Policy Change  |                |                |                |                |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Object Access  | File System,   | Success,       | Security       | 4656           | A handle to an | 560            |
|                | Registry, SAM, | Failure        |                |                | object was     |                |
|                | Handle         |                |                |                | requested      |                |
|                | Manipulation,  |                |                |                |                |                |
|                | Other Object   |                |                |                |                |                |
|                | Access Events  |                |                |                |                |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| Object Access  |                | Success        | Security       | 561            | Handle         |                |
|                |                |                |                |                | Allocated      |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| System         | Security State | Success        | Security       | 4608           | Windows is     | 512            |
|                | Change         |                |                |                | starting up    |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| System         | Security State | Success        | Security       | 4616           | The system     | 520            |
|                | Change         |                |                |                | time was       |                |
|                |                |                |                |                | changed.       |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| System         | Security       | Success        | Security       | 4610           | An             | 514            |
|                | System         |                |                |                | authentication |                |
|                | Extension      |                |                |                | package has    |                |
|                |                |                |                |                | been loaded by |                |
|                |                |                |                |                | the Local      |                |
|                |                |                |                |                | Security       |                |
|                |                |                |                |                | Authority      |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| System         | System         | Success        | Security       | 4612           | Internal       | 516            |
|                | Integrity      |                |                |                | resources      |                |
|                |                |                |                |                | allocated for  |                |
|                |                |                |                |                | the queuing of |                |
|                |                |                |                |                | audit messages |                |
|                |                |                |                |                | have been      |                |
|                |                |                |                |                | exhausted,     |                |
|                |                |                |                |                | leading to the |                |
|                |                |                |                |                | loss of some   |                |
|                |                |                |                |                | audits         |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
| System         | System         | Success        | Security       | 4615           | Invalid use of | 519            |
|                | Integrity      |                |                |                | LPC port       |                |
+----------------+----------------+----------------+----------------+----------------+----------------+----------------+
```

### Linux

#### Syslog

### IOC



## Network Analytics Plan

### Network probe

#### Configuration

#### Bad reputation

#### By source

#### By destination

#### Topology



## Security rules

### Windows security rules

````md
| Nr. | Architecture/Application | Rule Name                                                    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Index name   | Requirements                                     | Source                       | Time definition            | Threashold |
|-----|--------------------------|--------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|--------------------------------------------------|------------------------------|----------------------------|------------|
| 1   | Windows                  | Windows - Admin night logon                                  | Alert on Windows login events when detected outside business hours                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 2   | Windows                  | Windows - Admin task as user                                 | Alert when admin task is initiated by regular user.  Windows event id 4732 is verified towards static admin list. If the user does not belong to admin list AND the event is seen than we generate alert. Static Admin list is a logstash  disctionary file that needs to be created manually. During Logstash lookup a field user.role:admin is added to an event.4732: A member was added to a security-enabled local group                                                                                                                                                                                                                                       | winlogbeat-* | winlogbeatLogstash admin dicstionary lookup file | Widnows Security Eventlog    | Every 1min                 | 1          |
| 3   | Windows                  | Windows - diff IPs logon                                     | Alert when Windows logon process is detected and two or more different IP addressed are seen in source field.  Timeframe is last 15min.Detection is based onevents 4624 or 1200.4624: An account was successfully logged on1200: Application token success                                                                                                                                                                                                                                                                                                                                                                                                          | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min, for last 15min | 1          |
| 4   | Windows                  | Windows - Event service error                                | Alert when Windows event 1108 is matched1108: The event logging service encountered an error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 5   | Windows                  | Windows - file insufficient privileges                       | Alert when Windows event 5145 is matched5145: A network share object was checked to see whether client can be granted desired accessEvery time a network share object (file or folder) is accessed, event 5145 is logged. If the access is denied at the file share level, it is audited as a failure event. Otherwise, it considered a success. This event is not generated for NTFS access.                                                                                                                                                                                                                                                                       | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min, for last 15min | 50         |
| 6   | Windows                  | Windows - Kerberos pre-authentication failed                 | Alert when Windows event 4625 or 4771 is matched 4625: An account failed to log on 4771: Kerberos pre-authentication failed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 7   | Windows                  | Windows - Logs deleted                                       | Alert when Windows event 1102 OR 104 is matched1102: The audit log was cleared104: Event log cleared                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 8   | Windows                  | Windows - Member added to a security-enabled global group    | Alert when Windows event 4728 is matched4728: A member was added to a security-enabled global group                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 9   | Windows                  | Windows - Member added to a security-enabled local group     | Alert when Windows event 4732 is matched4732: A member was added to a security-enabled local group                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 10  | Windows                  | Windows - Member added to a security-enabled universal group | Alert when Windows event 4756 is matched4756: A member was added to a security-enabled universal group                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 11  | Windows                  | Windows - New device                                         | Alert when Windows event 6414 is matched6416: A new external device was recognized by the system                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 12  | Windows                  | Windows - Package installation                               | Alert when Windows event 4697 is matched 4697: A service was installed in the system                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 13  | Windows                  | Windows - Password policy change                             | Alert when Windows event 4739 is matched4739: Domain Policy was changed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 14  | Windows                  | Windows - Security log full                                  | Alert when Windows event 1104 is matched1104: The security Log is now full                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 15  | Windows                  | Windows - Start up                                           | Alert when Windows event 4608 is matched 4608: Windows is starting up                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 16  | Windows                  | Windows - Account lock                                       | Alert when Windows event 4740 is matched4740: A User account was Locked out                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 17  | Windows                  | Windows - Security local group was changed                   | Alert when Windows event 4735 is matched4735: A security-enabled local group was changed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 18  | Windows                  | Windows - Reset password attempt                             | Alert when Windows event 4724 is matched4724: An attempt was made to reset an accounts password                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 19  | Windows                  | Windows - Code integrity changed                             | Alert when Windows event 5038 is matched5038: Detected an invalid image hash of a fileInformation:    Code Integrity is a feature that improves the security of the operating system by validating the integrity of a driver or system file each time it is loaded into memory.    Code Integrity detects whether an unsigned driver or system file is being loaded into the kernel, or whether a system file has been modified by malicious software that is being run by a user account with administrative permissions.    On x64-based versions of the operating system, kernel-mode drivers must be digitally signed.The event logs the following information: | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 20  | Windows                  | Windows - Application error                                  | Alert when Windows event 1000 is matched1000: Application error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | winlogbeat-* | winlogbeat                                       | Widnows Application Eventlog | Every 1min                 | 1          |
| 21  | Windows                  | Windows - Application hang                                   | Alert when Windows event 1001 OR 1002 is matched1001: Application fault bucket1002: Application hang                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | winlogbeat-* | winlogbeat                                       | Widnows Application Eventlog | Every 1min                 | 1          |
| 22  | Windows                  | Windows - Audit policy changed                               | Alert when Windows event 4719 is matched4719: System audit policy was changed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 23  | Windows                  | Windows - Eventlog service stopped                           | Alert when Windows event 6005 is matched6005: Eventlog service stopped                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 24  | Windows                  | Windows - New service installed                              | Alert when Windows event 7045 OR 4697 is matched7045,4697: A service was installed in the system                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 25  | Windows                  | Windows - Driver loaded                                      | Alert when Windows event 6 is matched6: Driver loadedThe driver loaded events provides information about a driver being loaded on the system. The configured hashes are provided as well as signature information. The signature is created asynchronously for performance reasons and indicates if the file was removed after loading.                                                                                                                                                                                                                                                                                                                             | winlogbeat-* | winlogbeat                                       | Widnows System Eventlog      | Every 1min                 | 1          |
| 26  | Windows                  | Windows - Firewall rule modified                             | Alert when Windows event 2005 is matched2005: A Rule has been modified in the Windows firewall Exception List                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 27  | Windows                  | Windows - Firewall rule add                                  | Alert when Windows event 2004 is matched2004: A firewall rule has been added                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
| 28  |                          | Windows - Firewall rule deleted                              | Alert when Windows event 2006 or 2033 or 2009 is matched2006,2033,2009: Firewall rule deleted                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | winlogbeat-* | winlogbeat                                       | Widnows Security Eventlog    | Every 1min                 | 1          |
````



## Windows Security Alerts

|Nr.|Architecture/Application|Rule Name|Description|Index name|Requirements|Source|Rule type|Rule definition|
|:--|:--|:--|:--|:--|:--|:--|:--|:--|
|1|Windows|Windows - Admin night logon|Alert on Windows login events when detected outside business hours|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/> - query_string:<br/>     query: "event_id:(4624 OR 1200) AND user.role:admin  AND event.hour:(20 OR 21 OR 22 OR 23 0 OR 1 OR 2 OR 3)"|
|2|Windows|Windows - Admin task as user|Alert when admin task is initiated by regular user.  <br/>Windows event id 4732 is verified towards static admin list. If the user does not belong to admin list AND the event is seen than we generate alert. <br/>Static Admin list is a logstash  disctionary file that needs to be created manually. During Logstash lookup a field user.role:admin is added to an event.<br/>4732: A member was added to a security-enabled local group|winlogbeat-*|winlogbeat<br/>Logstash admin dicstionary lookup file|Widnows Security Eventlog|any|filter:<br/> - query_string:<br/>     query: "event_id:4732 AND NOT user.role:admin"|
|3|Windows|Windows - diff IPs logon|Alert when Windows logon process is detected and two or more different IP addressed are seen in source field.  Timeframe is last 15min.<br/>Detection is based onevents 4624 or 1200.<br/>4624: An account was successfully logged on<br/>1200: Application token success|winlogbeat-*|winlogbeat|Widnows Security Eventlog|cardinality|max_cardinality: 1<br/>timeframe:<br/>   minutes: 15<br/>filter:<br/> - query_string:<br/>     query: "event_id:(4624 OR 1200) AND NOT _exists_:user.role AND NOT event_data.IpAddress:\"-\" "<br/>query_key: username|
|4|Windows|Windows - Event service error|Alert when Windows event 1108 is matched<br/>1108: The event logging service encountered an error |winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:1108"|
|5|Windows|Windows - file insufficient privileges|Alert when Windows event 5145 is matched<br/>5145: A network share object was checked to see whether client can be granted desired access<br/>Every time a network share object (file or folder) is accessed, event 5145 is logged. If the access is denied at the file share level, it is audited as a failure event. Otherwise, it considered a success. This event is not generated for NTFS access.|winlogbeat-*|winlogbeat|Widnows Security Eventlog|frequency|query_key: "event_data.IpAddress"<br/>num_events: 50<br/>timeframe:<br/>  minutes: 15<br/>filter:<br/> - query_string:<br/>     query: "event_id:5145"|
|6|Windows|Windows - Kerberos pre-authentication failed|Alert when Windows event 4625 or 4771 is matched<br/> 4625: An account failed to log on<br/> 4771: Kerberos pre-authentication failed|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/> - query_string:<br/>     query: "event_id:4625 OR event_id:4771"|
|7|Windows|Windows - Logs deleted|Alert when Windows event 1102 OR 104 is matched<br/>1102: The audit log was cleared<br/>104: Event log cleared|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: 'event_desc:"1102 The audit log was cleared"'|
|8|Windows|Windows - Member added to a security-enabled global group|Alert when Windows event 4728 is matched<br/>4728: A member was added to a security-enabled global group|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/> - query_string:<br/>     query: "event_id:4728"|
|9|Windows|Windows - Member added to a security-enabled local group|Alert when Windows event 4732 is matched<br/>4732: A member was added to a security-enabled local group|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/> - query_string:<br/>     query: "event_id:4732"|
|10|Windows|Windows - Member added to a security-enabled universal group|Alert when Windows event 4756 is matched<br/>4756: A member was added to a security-enabled universal group|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/> - query_string:<br/>     query: "event_id:4756"|
|11|Windows|Windows - New device|Alert when Windows event 6414 is matched<br/>6416: A new external device was recognized by the system|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:6416"|
|12|Windows|Windows - Package installation|Alert when Windows event 4697 is matched<br/> 4697: A service was installed in the system|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:4697"|
|13|Windows|Windows - Password policy change|Alert when Windows event 4739 is matched<br/>4739: Domain Policy was changed|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:4739"|
|14|Windows|Windows - Security log full|Alert when Windows event 1104 is matched<br/>1104: The security Log is now full|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:1104"|
|15|Windows|Windows - Start up|Alert when Windows event 4608 is matched<br/> 4608: Windows is starting up|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:4608"|
|16|Windows|Windows - Account lock|Alert when Windows event 4740 is matched<br/>4740: A User account was Locked out|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:4740"|
|17|Windows|Windows - Security local group was changed|Alert when Windows event 4735 is matched<br/>4735: A security-enabled local group was changed|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:4735"|
|18|Windows|Windows - Reset password attempt|Alert when Windows event 4724 is matched<br/>4724: An attempt was made to reset an accounts password|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:4724"|
|19|Windows|Windows - Code integrity changed|Alert when Windows event 5038 is matched<br/>5038: Detected an invalid image hash of a file<br/>Information:<br/><br/>    Code Integrity is a feature that improves the security of the operating system by validating the integrity of a driver or system file each time it is loaded into memory.<br/>    Code Integrity detects whether an unsigned driver or system file is being loaded into the kernel, or whether a system file has been modified by malicious software that is being run by a user account with administrative permissions.<br/>    On x64-based versions of the operating system, kernel-mode drivers must be digitally signed.<br/><br/>The event logs the following information:|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:5038"|
|20|Windows|Windows - Application error|Alert when Windows event 1000 is matched<br/>1000: Application error|winlogbeat-*|winlogbeat|Widnows Application Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:1000"|
|21|Windows|Windows - Application hang|Alert when Windows event 1001 OR 1002 is matched<br/>1001: Application fault bucket<br/>1002: Application hang|winlogbeat-*|winlogbeat|Widnows Application Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:1002 OR event_id:1001"|
|22|Windows|Windows - Audit policy changed|Alert when Windows event 4719 is matched<br/>4719: System audit policy was changed|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:4719"|
|23|Windows|Windows - Eventlog service stopped|Alert when Windows event 6005 is matched<br/>6005: Eventlog service stopped|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:6005"|
|24|Windows|Windows - New service installed|Alert when Windows event 7045 OR 4697 is matched<br/>7045,4697: A service was installed in the system|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:7045 OR event_id:4697"|
|25|Windows|Windows - Driver loaded|Alert when Windows event 6 is matched<br/>6: Driver loaded<br/>The driver loaded events provides information about a driver being loaded on the system. The configured hashes are provided as well as signature information. The signature is created asynchronously for performance reasons and indicates if the file was removed after loading.|winlogbeat-*|winlogbeat|Widnows System Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:6"|
|26|Windows|Windows - Firewall rule modified|Alert when Windows event 2005 is matched<br/>2005: A Rule has been modified in the Windows firewall Exception List|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: 'event_desc:"4947 A change has been made to Windows Firewall exception list. A rule was modified"'|
|27|Windows|Windows - Firewall rule add|Alert when Windows event 2004 is matched<br/>2004: A firewall rule has been added|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:2004"|
|28|Windows|Windows - Firewall rule deleted|Alert when Windows event 2006 or 2033 or 2009 is matched<br/>2006,2033,2009: Firewall rule deleted|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: "event_id:2006 OR event_id:2033 OR event_id:2009"|
|29|Windows|Windows - System has been shutdown |This event is written when an application causes the system to restart, or when the user initiates a restart or shutdown by clicking Start or pressing CTRL+ALT+DELETE, and then clicking Shut Down.|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: 'event_id:"1074"'|
|30|Windows|Windows - The system time was changed|The system time has been changed. The event describes the old and new time.|winlogbeat-*|winlogbeat|Widnows Security Eventlog|any|filter:<br/>- query_string:<br/>       query: 'event_id:"4616"'|